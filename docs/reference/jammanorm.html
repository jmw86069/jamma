<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Normalize data using MA-plot logic — jammanorm • jamma</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Normalize data using MA-plot logic — jammanorm" />
<meta property="og:description" content="Normalize data using MA-plot logic" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">jamma</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.16.900</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/jamma-vignette.html">Introduction to jamma</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="http://github.com/jmw86069/jamma/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Normalize data using MA-plot logic</h1>
    <small class="dont-index">Source: <a href='http://github.com/jmw86069/jamma/blob/master/R/jamma-norm.R'><code>R/jamma-norm.R</code></a></small>
    <div class="hidden name"><code>jammanorm.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Normalize data using MA-plot logic</p>
    </div>

    <pre class="usage"><span class='fu'>jammanorm</span><span class='op'>(</span>
  <span class='va'>x</span>,
  controlGenes <span class='op'>=</span> <span class='cn'>NULL</span>,
  minimum_mean <span class='op'>=</span> <span class='fl'>0</span>,
  controlSamples <span class='op'>=</span> <span class='cn'>NULL</span>,
  centerGroups <span class='op'>=</span> <span class='cn'>NULL</span>,
  useMedian <span class='op'>=</span> <span class='cn'>FALSE</span>,
  useMean <span class='op'>=</span> <span class='cn'>NULL</span>,
  noise_floor <span class='op'>=</span> <span class='op'>-</span><span class='cn'>Inf</span>,
  noise_floor_value <span class='op'>=</span> <span class='va'>noise_floor</span>,
  verbose <span class='op'>=</span> <span class='cn'>FALSE</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p><code>numeric</code> matrix with expression data suitable for use
by <code><a href='jammaplot.html'>jammaplot()</a></code>. Gene expression data is typically transformed
using <code><a href='https://rdrr.io/r/base/Log.html'>log2(1+x)</a></code> to represent reasonably normal distribution.</p></td>
    </tr>
    <tr>
      <th>minimum_mean</th>
      <td><p><code>numeric</code> value used to filter <code>controlGenes</code>,
a control gene must have at least this level of expression to
be included in the normalization, where the expression is
determined by the mean or median value analogous to the x-axis
value in MA-plots.</p></td>
    </tr>
    <tr>
      <th>controlSamples</th>
      <td><p><code>character</code> vector of <code><a href='https://rdrr.io/r/base/colnames.html'>colnames(x)</a></code> passed
to <code><a href='centerGeneData.html'>centerGeneData()</a></code> which defines the control samples during
the data centering step.
By default, and the most common practice, MA-plots are
calculated across all samples, which effectively uses all
<code><a href='https://rdrr.io/r/base/colnames.html'>colnames(x)</a></code> as <code>controlSamples</code>.
However, it is quite useful sometimes to provide a subset of
samples especially if there are known quality samples, to which
new samples of unknown quality are being compared.</p></td>
    </tr>
    <tr>
      <th>centerGroups</th>
      <td><p><code>character</code> vector of groups passed to
<code><a href='centerGeneData.html'>jamma::centerGeneData()</a></code> which determines how data is centered.
Each group is centered independently, to enable visual
comparisons within each relevant centering group.
It is useful to center within batches or within
subsets of samples that are not intended to be compared to
one another.
Another useful alternative is to center by each sample
group in order to view the variability among group
replicates, which should be much lower than variability across
sample groups. See <code><a href='centerGeneData.html'>centerGeneData()</a></code> for more specific examples.</p></td>
    </tr>
    <tr>
      <th>useMedian</th>
      <td><p><code>logical</code> indicates whether to center data
using the <code>median</code> value, where <code>useMedian=FALSE</code> by default.
For consistency, this argument is preferred to <code>useMean</code> which
is deprecated and will be removed in future. The median is
preferred in cases where outliers should not influence the
centering. The mean is preferred in cases where the data
should visualize data consistent with downstream parametric
statistical analysis. When a particular sample
is a technical outlier, one option is to define
<code>controlSamples</code> to exclude the outlier sample(s), so
the data centering will be applied using the non-outlier
samples as reference.</p></td>
    </tr>
    <tr>
      <th>useMean</th>
      <td><p><code>logical</code> (deprecated), use <code>useMean</code>. This argument
indicates whether to center data using the <code>mean</code> value.
When <code>useMean=NULL</code> the argument <code>useMedian</code> is preferred.
For backward compatibility, when <code>useMean</code> is not <code>NULL</code>,
then <code>useMedian</code> is defined by <code>useMedian &lt;- !useMean</code>.</p></td>
    </tr>
    <tr>
      <th>noise_floor, noise_floor_value</th>
      <td><p><code>numeric</code> values passed
to <code><a href='jammacalc.html'>jammacalc()</a></code>. The <code>noise_floor</code> is the value below which
a floor is applied. The floor sets all values below this floor
to <code>noise_floor_value</code>. For example, one could apply <code>noise_floor=0</code>
and <code>noise_floor_value=NA</code> which would change any value below 0
to <code>NA</code>.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>logical indicating whether to print verbose output.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>additional parameters sent to downstream functions,
<code><a href='https://rdrr.io/pkg/jamba/man/plotSmoothScatter.html'>jamba::plotSmoothScatter</a></code>, <code><a href='centerGeneData.html'>centerGeneData</a></code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>numeric matrix whose columns have been normalized using
the y-axis mean offset following MA-plot calculations. The output
contains attributes: <code>"nf"</code> numeric vector of normalization factors;
<code>"hk"</code> list of controlGenes used for each sample; <code>"hk_count"</code> the
number of controlGenes used for each sample.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This function normalizes data using an approach analogous
to data viewed in MA-plots. Normalization is applied by shifting
data along the y-axis so the mean (or median) expression among
control genes is zero, shown on an MA-plot as y=0.</p>
<p>It effectively reinforces the assumption that the mean log fold
change for control genes is expected to be zero. When <code>useMedian=TRUE</code>
it reinforces the assumption that the log fold change for the
majority of control genes should be zero.</p>
<p>It is useful to run <code><a href='jammaplot.html'>jammaplot()</a></code> data after <code>jammanorm()</code>
to visualize the effect of this normalization. If data is not
centered at y=0, the parameters should be adjusted.</p><h3 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>About the normalization</h3>


<p>This normalization is a "linear normalization" in that it uniformly
shifts data up or down relative to other samples, without
modifying the relative distribution of signal. It is very similar
to housekeeper normalization, geometric mean normalization, and
global signal scaling, which are all also "linear normalization"
methods. An example of non-linear normalization is quantile or
VSN normalization.</p>
<p>The control genes can be defined upfront with <code>controlGenes</code>,
which can be housekeeper genes, or a custom subset of genes.
The <code>controlGenes</code> are filtered to require the mean or median
expression at or above <code>minimum_mean</code> in order to be used
during normalization.</p>
<p>The <code>minimum_mean</code> threshold is useful and important to match
the variability seen in the MA-plots. For example data below
a certain x-axis value may have very high variability, and
should usually not be used for normalization.</p>
<p>When the MA-plot after normalization does not show signal centered
at y=0, the most common and effective adjustment is to apply
<code>minimum_mean</code> to require <code>controGenes</code> to have expression
at or above this threshold. The next most effective option is
<code>useMedian=TRUE</code> which will center the majority of genes at
y=0 instead of the overall mean at y=0.</p>

<h3 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>Comparison to geometric mean normalization</h3>


<p>The end result is very similar to other housekeeper normalization
methods which typically define normalization factors by
calculating the geometric mean of log-transformed housekeeper
gene abundances. Such approaches usually work in part because
higher expressed housekeeper genes usually have lower variability,
which keeps the influence on geometric mean reasonably consistent
across a broad range of expression. That said, genes with higher
expression have more influence on the geometric mean than genes
with much lower expression.</p>
<p>However, the strategy with <code>jammanorm()</code> is to assert that
the mean difference from average expression for the <code>controlGenes</code>
should be equal to zero. The effect is applied evenly across
control genes by evaluating the mean or median difference from y=0
for each sample.</p>

<h3 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>Assumptions</h3>


<p>In order for this approach to be valid:</p><ul>
<li><p>Data on the MA-plots should be horizontal for all samples,
particularly for <code>controlGenes</code>. When data is not horizontal
across samples, data should instead be normalized using another
approach, typically something like quantile normalization which
is intended to impose a consistent signal distribution across
all samples.</p></li>
<li><p>The majority of <code>controlGenes</code> should not be changing, therefore
the <code>controlGenes</code> should not have substantial variation along
the y-axis within each sample.</p></li>
<li><p>For data with a small number of genes, normalization should use
a set of pre-defined <code>controlGenes</code> that were verified to have
no change across samples.</p></li>
</ul>


<h3 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>Noise threshold</h3>


<p>Note that some platform technologies generate a noise threshold,
below which data may be skewed up or down relative to other samples.
It is recommended to ignore this type of skew below the threshold
when determining whether data is horizontal on MA-plots.</p>
<p>For example Nanostring data includes a series of positive and
negative control probes, and a suitable noise threshold is either
the midpoint between the lowest positive and highest negative probe,
or the lowest positive probe. When this noise threshold is applied,
data above the noise threshold is typically horizontal, although
data below the threshold may be skewed up or down depending upon
the effective input RNA concentration.</p>

    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>Other jam matrix functions: 
<code><a href='centerGeneData.html'>centerGeneData</a>()</code>,
<code><a href='jammacalc.html'>jammacalc</a>()</code></p></div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by James Ward.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


