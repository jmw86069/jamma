<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Normalize data using MA-plot logic — jammanorm • jamma</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Normalize data using MA-plot logic — jammanorm"><meta property="og:description" content="Normalize data using MA-plot logic"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">jamma</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.33.900</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/jamma-vignette.html">Introduction to jamma</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/jmw86069/jamma/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Normalize data using MA-plot logic</h1>
    <small class="dont-index">Source: <a href="https://github.com/jmw86069/jamma/blob/HEAD/R/jamma-norm.R" class="external-link"><code>R/jamma-norm.R</code></a></small>
    <div class="hidden name"><code>jammanorm.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Normalize data using MA-plot logic</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">jammanorm</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  controlGenes <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  minimum_mean <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  controlSamples <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  centerGroups <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  useMedian <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  useMean <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  noise_floor <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,</span>
<span>  noise_floor_value <span class="op">=</span> <span class="va">noise_floor</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p><code>numeric</code> matrix with expression data suitable for use
by <code><a href="jammaplot.html">jammaplot()</a></code>. Gene expression data is typically transformed
using <code>log2(1+x)</code> to represent reasonably normal distribution.</p></dd>


<dt>minimum_mean</dt>
<dd><p><code>numeric</code> value used to filter <code>controlGenes</code>,
a control gene must have at least this level of expression to
be included in the normalization, where the expression is
determined by the mean or median value analogous to the x-axis
value in MA-plots.</p></dd>


<dt>controlSamples</dt>
<dd><p><code>character</code> vector of <code>colnames(x)</code> passed
to <code><a href="centerGeneData.html">centerGeneData()</a></code> which defines the control samples during
the data centering step.
By default, and the most common practice, MA-plots are
calculated across all samples, which effectively uses all
<code>colnames(x)</code> as <code>controlSamples</code>.
However, it is quite useful sometimes to provide a subset of
samples especially if there are known quality samples, to which
new samples of unknown quality are being compared.</p></dd>


<dt>centerGroups</dt>
<dd><p><code>character</code> vector of groups passed to
<code><a href="centerGeneData.html">jamma::centerGeneData()</a></code> which determines how data is centered.
Each group is centered independently, to enable visual
comparisons within each relevant centering group.
It is useful to center within batches or within
subsets of samples that are not intended to be compared to
one another.
Another useful alternative is to center by each sample
group in order to view the variability among group
replicates, which should be much lower than variability across
sample groups. See <code><a href="centerGeneData.html">centerGeneData()</a></code> for more specific examples.</p></dd>


<dt>useMedian</dt>
<dd><p><code>logical</code> indicates whether to center data
using the <code>median</code> value, where <code>useMedian=FALSE</code> by default.
The median is preferred in cases where outliers should not influence
centering.
The mean is preferred in cases where the data should visualize
data in a manner consistent with downstream parametric
statistical analysis.
When a particular sample represents a technical outlier,
one option to visualize data without being skewed by the outlier
is to define <code>controlSamples</code> to exclude the outlier sample(s).
In this way, data centering will be applied using the non-outlier
samples as reference.</p></dd>


<dt>useMean</dt>
<dd><p>(deprecated) <code>logical</code>, use <code>useMedian</code>. This argument
indicates whether to center data using the <code>mean</code> value.
When <code>useMean=NULL</code> the argument <code>useMedian</code> is preferred.
For backward compatibility, when <code>useMean</code> is not <code>NULL</code>,
then <code>useMedian</code> is defined by <code>useMedian &lt;- !useMean</code>.</p></dd>


<dt>noise_floor, noise_floor_value</dt>
<dd><p><code>numeric</code> values passed
to <code><a href="jammacalc.html">jammacalc()</a></code>. The <code>noise_floor</code> is the value below which
a floor is applied. The floor sets all values below this floor
to <code>noise_floor_value</code>. For example, one could apply <code>noise_floor=0</code>
and <code>noise_floor_value=NA</code> which would change any value below 0
to <code>NA</code>.</p></dd>


<dt>verbose</dt>
<dd><p>logical indicating whether to print verbose output.</p></dd>


<dt>...</dt>
<dd><p>additional parameters sent to downstream functions,
<code><a href="https://rdrr.io/pkg/jamba/man/plotSmoothScatter.html" class="external-link">jamba::plotSmoothScatter()</a></code>, <code><a href="jammacalc.html">jammacalc()</a></code>, <code><a href="centerGeneData.html">centerGeneData()</a></code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p><code>numeric</code></p>
<p></p>
<p><code>matrix</code> whose columns have been normalized,
with the following named <code>attributes</code>:</p><ul><li><p><code>"nf"</code> numeric vector of normalization factors;</p></li>
<li><p><code>"hk"</code> a <code>character</code> vector of controlGenes for each sample;</p></li>
<li><p><code>"hk_count"</code> the <code>integer</code> number of controlGenes for each sample.</p></li>
</ul></div>
    <div id="details">
    <h2>Details</h2>
    <p>This function normalizes data using an approach analogous
to data viewed in MA-plots. Normalization is applied by shifting
data along the y-axis so the mean (or median) expression among
control genes is zero, indicated on an MA-plot as y=0.</p>
<p><strong>Note:</strong> This method should be performed only after reviewing the MA-plots,
to ensure the assumptions are met. Similarly, data can also be
viewed in MA-plots after normalization to confirm and review the
effect of normalization.</p>
<p>It is useful to run <code><a href="jammaplot.html">jammaplot()</a></code> data after <code>jammanorm()</code>
to visualize the effect of this normalization. If data is not
centered at y=0, the parameters should be adjusted.</p><div class="section">
<h3 id="assumptions">Assumptions<a class="anchor" aria-label="anchor" href="#assumptions"></a></h3>


<p>This method effectively reinforces the assumption that the mean log fold
change for control genes is expected to be zero. When <code>useMedian=TRUE</code>
it reinforces the assumption that the log fold change for the
majority of control genes should be zero.</p>
<p>Therefore, the assumptions may be summarized as follows:</p><ul><li><p>The principle assumption is that the set of <code>controlGenes</code>,
whose mean expression is at or above the <code>minimum_mean</code> value,
are unchanged within the respective <code>centerGroups</code>. For typical
whole genome transcript microarray and RNA-seq experiments,
this assumption is typically valid when using <code>useMedian=TRUE</code>.
For experiments with specific reference genes, or housekeeper
genes, this assumption may only be true for those specific genes.</p></li>
<li><p>The data signal is assumed to be a roughly linear representation
of the relative abundance of each measured entity, which is usually
true for log-transformed microarray intensity, or log-transformed
RNA-seq read counts. For QPCR or TaqMan, this assumption is valid
for the direct CT cycle threshold values, or after log-transformation
of the exponentiated CT values, for example 2^(40-CT).
All that said, a straightforward way to visualize this assumption
is with MA-plots, to confirm that signal is horizontal across
the full signal range - either for the majority of all genes,
or for the specific <code>controlGenes</code> used for normalization.</p></li>
<li><p>The variability among control genes should not be more than twice
the median absolute deviation across other samples within the
relevant <code>centerGroups</code>. Effectively this assumption means the
control genes on the MA-plot should not show wide spread along the
y-axis.</p></li>
</ul><p>In cases where some samples show non-horizontal signal across the
MA-plot, the data is not conforming to a consistent and proportional
signal across the response range of the experiment. In effect, it
means signal is being compressed, or expanded along the response
as compared to other samples in the same <code>centerGroups</code>. In this
scenario, the best normalization method may be
<code><a href="https://rdrr.io/pkg/limma/man/normalizequantiles.html" class="external-link">limma::normalizeQuantiles()</a></code>, <code><a href="https://rdrr.io/pkg/limma/man/normalizeCyclicLoess.html" class="external-link">limma::normalizeCyclicLoess()</a></code>,
or <code>vsn::vsn()</code>. These methods adjust the distribution of signal
to enforce consistency across samples.</p>
<p>In general, the signal distribution itself should not be adjusted
unless necessary, in order to retain as much information from the
underlying technology as possible. This method <code>jammanorm()</code> is
intended to apply linear normalization, which effectively shifts
the entire signal for a sample up or down relative to other samples.</p>
<p>This scenario is effective for technologies such as QPCR, TaqMan,
Nanostring counts, and RNA-seq counts or RNA-seq pseudocounts.</p>
<p>When the MA-plot demonstrates non-horizontal
signal, it is most often the result one or both of these influences:</p><ol><li><p>batch effect, imposed either by different upstream sample
processing steps among the samples being tested, or</p></li>
<li><p>platform technology that tends to produce relative signal strength
but not absolute quantitative signal, commonly seen with
microarray hybridization technologies such as Affymetrix, Illumina,
Agilent, SomaLogic, or Myriad RBM.</p></li>
</ol><p>Note that any upstream sample amplification technique may also impose
non-linear effects on the molecules being measured.</p>
<p>One method to test for a batch effect is to define <code>centerGroups</code>
to include batch, so the data will be centered for each batch
independently. If this centering resolves the non-horizontal
signal, then batch is very likely to be a component to be modeled
in the experiment. See <code><a href="https://rdrr.io/pkg/limma/man/removeBatchEffect.html" class="external-link">limma::removeBatchEffect()</a></code>. The batch effect
adjustment by  <code><a href="https://rdrr.io/pkg/limma/man/removeBatchEffect.html" class="external-link">limma::removeBatchEffect()</a></code> and <code>sva::ComBat()</code>
almost exactly subtract the batch component from the signal.</p>
<p>That said, it may or may not be ideal to apply batch adjustment
prior to running downstream statistical tests, as opposed to
including batch as a covariate term in the statistical
model used for testing, example when using <code>DESeq2</code>.
The main benefit of applying batch adjustment at this step is to
visualize data downstream consistent with the method used by
those statistical tests, or when running a clustering technique
that does not have the capability of applying appropriate
batch effect modeling.</p>
</div>

<div class="section">
<h3 id="about-the-normalization">About the normalization<a class="anchor" aria-label="anchor" href="#about-the-normalization"></a></h3>


<p>This normalization is a "linear normalization" in that it uniformly
shifts data up or down relative to other samples, without
modifying the relative distribution of signal. It is very similar
to housekeeper normalization, geometric mean normalization, and
global signal scaling, which are all also "linear normalization"
methods. An example of non-linear normalization is quantile or
VSN normalization.</p>
<p>The control genes can be defined upfront with <code>controlGenes</code>,
which can be housekeeper genes, or a custom subset of genes.
The <code>controlGenes</code> are filtered to require the mean or median
expression at or above <code>minimum_mean</code> in order to be used
during normalization.</p>
<p>The <code>minimum_mean</code> threshold is useful and important to match
the variability seen in the MA-plots. For example data below
a certain x-axis value may have very high variability, and
should usually not be used for normalization.</p>
<p>When the MA-plot after normalization does not show signal centered
at y=0, the most common and effective adjustment is to apply
<code>minimum_mean</code> to require <code>controGenes</code> to have expression
at or above this threshold. The next most effective option is
<code>useMedian=TRUE</code> which will center the majority of genes at
y=0 instead of the overall mean at y=0.</p>
</div>

<div class="section">
<h3 id="comparison-to-geometric-mean-normalization">Comparison to geometric mean normalization<a class="anchor" aria-label="anchor" href="#comparison-to-geometric-mean-normalization"></a></h3>


<p>The end result is very similar to other housekeeper normalization
methods which typically define normalization factors by
calculating the geometric mean of log-transformed housekeeper
gene abundances. Such approaches usually work in part because
higher expressed housekeeper genes usually have lower variability,
which keeps the influence on geometric mean reasonably consistent
across a broad range of expression. That said, genes with higher
expression have more influence on the geometric mean than genes
with much lower expression.</p>
<p>However, the strategy with <code>jammanorm()</code> is to assert that
the mean difference from average expression for the <code>controlGenes</code>
should be equal to zero. The effect is applied evenly across
control genes by evaluating the mean or median difference from y=0
for each sample.</p>
</div>

<div class="section">
<h3 id="noise-threshold">Noise threshold<a class="anchor" aria-label="anchor" href="#noise-threshold"></a></h3>


<p>Note that some platform technologies generate a noise threshold,
below which data may be skewed up or down relative to other samples.
It is recommended to ignore this type of skew below the threshold
when determining whether data is horizontal on MA-plots.</p>
<p>For example Nanostring data includes a series of positive and
negative control probes, and a suitable noise threshold is either
the midpoint between the lowest positive and highest negative probe,
or the lowest positive probe. When this noise threshold is applied,
data above the noise threshold is typically horizontal, although
data below the threshold may be skewed up or down depending upon
the effective input RNA concentration.</p>
</div>

    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Other jam matrix functions: 
<code><a href="centerGeneData.html">centerGeneData</a>()</code>,
<code><a href="jammacalc.html">jammacalc</a>()</code>,
<code><a href="matrix_to_column_rank.html">matrix_to_column_rank</a>()</code></p></div>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by James Ward.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

